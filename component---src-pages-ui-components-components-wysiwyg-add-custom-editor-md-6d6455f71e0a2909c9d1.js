"use strict";(self.webpackChunkcommerce_frontend_core=self.webpackChunkcommerce_frontend_core||[]).push([[2770],{10726:function(e,n,t){t.r(n),t.d(n,{_frontmatter:function(){return m},default:function(){return c}});var i=t(87462),a=t(63366),o=(t(15007),t(64983)),r=t(91515),d=["components"],m={},l={_frontmatter:m},s=r.Z;function c(e){var n=e.components,t=(0,a.Z)(e,d);return(0,o.mdx)(s,(0,i.Z)({},l,t,{components:n,mdxType:"MDXLayout"}),(0,o.mdx)("h1",{id:"add-a-custom-editor"},"Add a custom editor"),(0,o.mdx)("p",null,"This tutorial goes through the process of adding ",(0,o.mdx)("a",{parentName:"p",href:"https://ckeditor.com/ckeditor-4/"},"CKEditor4")," as an editor that can be used by the WYSIWYG UI component."),(0,o.mdx)("p",null,"As a developer, use this tutorial as a guide for adding your own custom JavaScript editor to Magento."),(0,o.mdx)("h2",{id:"step-1-make-the-editor-library-available"},"Step 1. Make the editor library available"),(0,o.mdx)("p",null,"Download and install your editor's library into your module's ",(0,o.mdx)("inlineCode",{parentName:"p"},"view/base/web/js")," directory to have the application publish it under ",(0,o.mdx)("inlineCode",{parentName:"p"},"pub/static"),"."),(0,o.mdx)("h2",{id:"step-2-register-editor"},"Step 2. Register editor"),(0,o.mdx)("p",null,"In your module's ",(0,o.mdx)("inlineCode",{parentName:"p"},"etc/adminhtml/di.xml")," file, add your editor to the list of ",(0,o.mdx)("inlineCode",{parentName:"p"},"adapterOptions")," to include it to the list of available WYSIWYG editors in the Admin."),(0,o.mdx)("p",null,"Provide unique values for the ",(0,o.mdx)("inlineCode",{parentName:"p"},"name")," parameter and the ",(0,o.mdx)("inlineCode",{parentName:"p"},"value")," and ",(0,o.mdx)("inlineCode",{parentName:"p"},"label")," entries for your editor to avoid naming collisions."),(0,o.mdx)("p",null,"If you are also extending or overriding the configuration for Variable, Widget, or Gallery, you must use the same string as the ",(0,o.mdx)("inlineCode",{parentName:"p"},"value")," entry."),(0,o.mdx)("blockquote",null,(0,o.mdx)("p",{parentName:"blockquote"},"CKEditor registration in ",(0,o.mdx)("inlineCode",{parentName:"p"},"app/code/CKEditor/CKEditor4/etc/adminhtml/di.xml"))),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-xml"},'<type name="Magento\\Cms\\Model\\Config\\Source\\Wysiwyg\\Editor">\n    <arguments>\n        <argument name="adapterOptions" xsi:type="array">\n            <item name="ckeditor" xsi:type="array">\n                <item name="value" xsi:type="string">CKEditor_CKEditor4/ckeditor4Adapter</item>\n                <item name="label" xsi:type="string" translatable="true">ckeditor</item>\n            </item>\n        </argument>\n    </arguments>\n</type>\n')),(0,o.mdx)("p",null,"To avoid issues in the case that we remove or disable the adapter module, add this configuration to the ",(0,o.mdx)("inlineCode",{parentName:"p"},"di.xml")," file:"),(0,o.mdx)("blockquote",null,(0,o.mdx)("p",{parentName:"blockquote"},"Configuration in ",(0,o.mdx)("inlineCode",{parentName:"p"},"di.xml"))),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-xml"},'<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework:ObjectManager/etc/config.xsd">\n    <type name="Magento\\Ui\\Block\\Wysiwyg\\ActiveEditor">\n        <arguments>\n            <argument name="availableAdapterPaths" xsi:type="array">\n                <item name="CKEditor_CKEditor4/ckeditor4Adapter" xsi:type="string"/>\n            </argument>\n        </arguments>\n    </type>\n</config>\n')),(0,o.mdx)("h2",{id:"step-3-create-editor-adapter"},"Step 3. Create editor adapter"),(0,o.mdx)("p",null,"Create an adapter for your editor in your module's ",(0,o.mdx)("inlineCode",{parentName:"p"},"view/base/web")," directory.\nThis adapter should implement the extensions points called by ",(0,o.mdx)("inlineCode",{parentName:"p"},"wysiwygInstance")," in the following file:"),(0,o.mdx)("p",null,(0,o.mdx)("inlineCode",{parentName:"p"},"lib/mage/adminhtml/wysiwyg/tiny_mce/setup.js")),(0,o.mdx)("p",null,"At minimum your adapter should implement the following methods:"),(0,o.mdx)("ul",null,(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("inlineCode",{parentName:"li"},"getAdapterPrototype()")),(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("inlineCode",{parentName:"li"},"setup( mode )")),(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("inlineCode",{parentName:"li"},"openFileBrowser( o )")),(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("inlineCode",{parentName:"li"},"toggle()")),(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("inlineCode",{parentName:"li"},"onFormValidation()")),(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("inlineCode",{parentName:"li"},"encodeContent(content)"))),(0,o.mdx)("p",null,"If you are integrating entities such as variable and widget as plugins, your adapter must also implement the following methods:"),(0,o.mdx)("ul",null,(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("p",{parentName:"li"},(0,o.mdx)("inlineCode",{parentName:"p"},"get( id )")," - returns the editor by it element id")),(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("p",{parentName:"li"},(0,o.mdx)("inlineCode",{parentName:"p"},"getContent()")," - returns the content stored in the WYSIWYG field")),(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("p",{parentName:"li"},(0,o.mdx)("inlineCode",{parentName:"p"},"setContent(content)")," - replaces the entire contents of the WYSIWYG with the string content parameter")),(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("p",{parentName:"li"},(0,o.mdx)("inlineCode",{parentName:"p"},"insertContent( content )")," - inserts content into the editor")),(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("p",{parentName:"li"},(0,o.mdx)("inlineCode",{parentName:"p"},"setCaretOnElement( targetElement )")," - sets the caret location in the editor")),(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("p",{parentName:"li"},(0,o.mdx)("inlineCode",{parentName:"p"},"activeEditor()")," - returns the active editor as an object with a ",(0,o.mdx)("inlineCode",{parentName:"p"},"selection")," property."),(0,o.mdx)("p",{parentName:"li"},"The ",(0,o.mdx)("inlineCode",{parentName:"p"},"selection")," property returns an instance of the editor with the following additional methods defined:"),(0,o.mdx)("ul",{parentName:"li"},(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("p",{parentName:"li"},(0,o.mdx)("inlineCode",{parentName:"p"},"getBookmark( type:Number, normalized:Boolean ):Object")," - returns a bookmark object that has the location for the current selection."),(0,o.mdx)("p",{parentName:"li"},"This is used to restore the selection after content modification in the document.")),(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("p",{parentName:"li"},(0,o.mdx)("inlineCode",{parentName:"p"},"moveToBookmark( bookmark:Object ):Boolean")," - restores the selection of the specified bookmark.")),(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("p",{parentName:"li"},(0,o.mdx)("inlineCode",{parentName:"p"},"getNode():Element")," - returns the currently selected element or common ancestor element for both start and end of the selection.")),(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("p",{parentName:"li"},(0,o.mdx)("inlineCode",{parentName:"p"},"select( targetElement )")," - selects the specified element."),(0,o.mdx)("p",{parentName:"li"},"This places the start and end of the selection range around the element.")),(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("p",{parentName:"li"},(0,o.mdx)("inlineCode",{parentName:"p"},"collapse( to_start:Boolean ):void")," - collapse the selection to start or end of range."))))),(0,o.mdx)("p",null,(0,o.mdx)("strong",{parentName:"p"},"Example:")," CKEditor/CKEditor4/view/base/web/ckeditor4Adapter.js"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-js"},"/**\n * Copyright Â© Magento, Inc. All rights reserved.\n * See COPYING.txt for license details.\n */\n\n/* global varienGlobalEvents, tinyMceEditors, MediabrowserUtility, closeEditorPopup, Base64 */\n/* eslint-disable strict */\ndefine([\n    'jquery',\n    'underscore',\n    'CKEditor_CKEditor4/js/ckeditor4/ckeditor',\n    'mage/translate',\n    'prototype',\n    'mage/adminhtml/events',\n    'jquery/ui'\n], function (jQuery, _, ckeditor4) {\n\n    var ckeditorWysiwyg = Class.create();\n\n    ckeditorWysiwyg.prototype = {\n        mediaBrowserOpener: null,\n        mediaBrowserTargetElementId: null,\n\n        /**\n         * @param {*} htmlId\n         * @param {Object} config\n         */\n        initialize: function (htmlId, config) {\n            this.id = htmlId;\n            this.config = config;\n\n            if (typeof ckeditorWysiwyg === 'undefined') {\n                window.ckeditorWysiwyg = $H({});\n            }\n\n            var settings = '';\n            ckeditorWysiwyg.settings = this.config;\n            settings = $H({});\n            if (this.config.plugins) {\n                this.config.plugins.each(function (plugin) {\n                    settings.set(plugin.name, plugin.options);\n                });\n                this.config.magentoPluginsOptions = settings;\n            }\n            this.config.elements = this.id;\n            ckeditor4.settings = this.config;\n        },\n\n        /**\n         * @param {*} mode\n         */\n        setup: function (mode) {\n            ckeditor4.replaceAll();\n        },\n\n        /**\n         * Insert content to active editor.\n         *\n         * @param {String} content\n         * @param {Boolean} ui\n         */\n        insertContent: function (content, ui) {\n            this.activeEditor().insertText(content);\n        },\n\n        /**\n         * @param {Object} o\n         */\n        openFileBrowser: function (o) {\n        },\n\n        /**\n         * Encodes the content so it can be inserted into the wysiwyg\n         * @param {String} content - The content to be encoded\n         *\n         * @returns {*} - The encoded content\n         */\n        updateContent: function (content) {\n        },\n\n        /**\n         * On form validation.\n         */\n        onFormValidation: function () {\n            if (tinyMCE4.get(this.id)) {\n                $(this.id).value = tinyMCE4.get(this.id).getContent();\n            }\n        },\n        /**\n         * @param {String} id\n         */\n        get: function (id) {\n            return ckeditor4.instances[id];\n        },\n\n        /**\n         * @return {Object}\n         */\n        activeEditor: function () {\n            var activeInstance = false;\n            _.each(ckeditor4.instances, function (instance) {\n                if (instance.activeEnterMode === 1) {\n                    activeInstance = instance;\n                    instance.getBookmark = function () {\n                        return null;\n                    };\n                    instance.moveToBookmark = function () {\n                        return instance;\n                    };\n                    instance.getNode = function () {\n                        return instance.getSelection();\n                    };\n                    instance.getNode = function () {\n                        return instance.getSelection();\n                    };\n                    activeInstance.selection = instance;\n\n                }\n            });\n            return activeInstance;\n        },\n\n        /**\n         * @param {*} mode\n         * @return {tinyMceWysiwygSetup}\n         */\n        turnOn: function (mode) {\n        },\n\n        /**\n         * @return {tinyMceWysiwygSetup}\n         */\n        turnOff: function () {\n\n            return this;\n        },\n\n        /**\n         * Retrieve directives URL with substituted directive value.\n         *\n         * @param {String} directive\n         */\n        makeDirectiveUrl: function (directive) {\n\n        },\n\n        /**\n         * @param {Object} content\n         * @return {*}\n         */\n        encodeDirectives: function (content) {\n\n        },\n\n        /**\n         * @param {Object} content\n         * @return {*}\n         */\n        encodeWidgets: function (content) {\n\n        },\n\n        /**\n         * @param {Object} content\n         * @return {*}\n         */\n        decodeDirectives: function (content) {\n\n        },\n\n        /**\n         * @param {Object} content\n         * @return {*}\n         */\n        decodeWidgets: function (content) {\n\n        },\n\n        /**\n         * @param {Object} attributes\n         * @return {Object}\n         */\n        parseAttributesString: function (attributes) {\n\n        },\n\n        /**\n         * Update text area.\n         */\n        updateTextArea: function () {\n\n        },\n        setCaretOnElement: function (targetElement) {\n            this.activeEditor().selection.select(targetElement);\n            this.activeEditor().selection.collapse();\n        },\n\n        /**\n         * @param {Object} content\n         * @return {*}\n         */\n        decodeContent: function (content) {\n\n        },\n\n        /**\n         * @return {Boolean}\n         */\n        toggle: function () {\n            return this.wysiwygInstance.toggle();\n        },\n\n        /**\n         * @param {Object} content\n         * @return {*}\n         */\n        encodeContent: function (content) {\n        },\n\n        /**\n         * @param {Object} o\n         */\n        beforeSetContent: function (o) {\n\n        },\n\n        /**\n         * @param {Object} o\n         */\n        saveContent: function (o) {\n\n        },\n\n        /**\n         * @returns {Object}\n         */\n        getAdapterPrototype: function () {\n            return ckeditorWysiwyg;\n        },\n\n        /**\n         * Return the content stored in the WYSIWYG field\n         * @param {String} id\n         * @return {String}\n         */\n        getContent: function (id) {\n\n        }\n    };\n\n    return ckeditorWysiwyg.prototype;\n});\n")),(0,o.mdx)("h2",{id:"step-4-load-editor-library"},"Step 4. Load editor library"),(0,o.mdx)("p",null,"After loading, modifying, and merging all configurations, the application serializes the result into a JSON object and passes it to the UI component."),(0,o.mdx)("p",null,"In your module's ",(0,o.mdx)("inlineCode",{parentName:"p"},"view/base/requirejs-config.js")," file, add a shim configuration entry for your editor in order to have RequireJS load it correctly."),(0,o.mdx)("p",null,(0,o.mdx)("strong",{parentName:"p"},"Example:")," CKEditor\\CKEditor4\\view\\base\\requirejs-config.js"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-json"},'var config = {\n    "shim": {\n        "CKEditor_CKEditor4/js/ckeditor4/ckeditor": { "exports": "CKEDITOR" }\n    }\n};\n')))}c.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-ui-components-components-wysiwyg-add-custom-editor-md-6d6455f71e0a2909c9d1.js.map